const t="tree",s="beta",i="alpha-start",e="alpha-end";class n extends EventTarget{constructor(t,s,i){super(),this.t=t,this.i=s,this.h=i,this.o=null,this.u=null,this.l=!1,this.p=!1,t.addEventListener("pointerdown",(t=>this.g(t))),t.addEventListener("pointermove",(t=>this.m(t))),t.addEventListener("pointerup",(t=>this.v(t))),document.addEventListener("keydown",(t=>this.M(t)))}_(t,s){this.dispatchEvent(new CustomEvent(t,{detail:s}))}M(t){"Escape"===t.key&&this.P&&!1===this.p&&(this.p=!0,this._("cancelled",t))}g(t){this.p=!1,t.target.setPointerCapture(t.pointerId),t.k=this.i(t.offsetX),t.S=this.h(t.offsetY),this._("pointerdown-begin",t),this.P=!0,this.o=t.k,this.u=t.S,this._("pointerdown-end",t)}m(t){if(!this.p){if(t.k=this.i(t.offsetX),t.S=this.h(t.offsetY),t.A=this.o,t.D=this.u,this._("pointermove-begin",t),this.P){const s=t.k-this.o,i=t.S-this.u;t.R=s,t.C=i,!1===this.l?(Math.abs(s)>6||Math.abs(i)>6)&&(this.l=!0,t.A=this.o,t.D=this.u,this._("drag-start",t)):(t.A=this.o,t.D=this.u,this._("drag-move",t))}else this._("nodrag-pointermove",t);this._("pointermove-end",t)}}v(t){if(t.target.releasePointerCapture(t.pointerId),this.p)return this.T(),void(this.p=!1);t.k=this.i(t.offsetX),t.S=this.h(t.offsetY),t.A=this.o,t.D=this.u,this._("pointerup-begin",t),this.l?this._("drag-finish",t):this._("click",t),this.T(),this._("pointerup-end",t)}T(){this.l=!1,this.P=!1,this.o=null,this.u=null}}class h extends EventTarget{constructor(t,s){super(),this.I=t,this.points=s??[],this.B=!1,this.G=0,this.N=0,this.$=6,this.F=6,this.L=!1,this.U=null,this.q=null,this.H=null,this.O=null,this.l=!1,this.V=new n(t,(s=>s-t.clientWidth/2),(s=>s-t.clientHeight/2)),this.V.addEventListener("pointerdown-begin",(t=>this.g(t.detail))),this.V.addEventListener("nodrag-pointermove",(t=>this.W(t.detail))),this.V.addEventListener("drag-start",(t=>this.X(t.detail))),this.V.addEventListener("drag-move",(t=>this.Y(t.detail))),this.V.addEventListener("drag-finish",(t=>this.K(t.detail))),this.V.addEventListener("click",(t=>this.j(t.detail))),this.V.addEventListener("pointerup-begin",(t=>this.v(t.detail))),this.V.addEventListener("cancelled",(t=>this.J(t.detail)))}Z(t){this.points=t;for(const s of t)this.tt(s,s.x,s.y)}st(t,s,i,e){t.it=this.et(s),t.nt=this.ht(i),this.dispatchEvent(new CustomEvent("pointmove",{detail:{ot:t,rt:e}}))}tt(t,s,i){this.st(t,s,i,"user")}get ct(){return this.U}get ut(){return this.q}get lt(){return this.B}get dt(){return this.G}get gt(){return this.N}static ft(t){return t.k=t.offsetX-t.target.clientWidth/2,t.S=t.offsetY-t.target.clientHeight/2,t}static vt(t,s,i,e){const n=i-t,h=e-s;return n*n+h*h}static Mt(t,s,i,e){return Math.sqrt(h.vt(t,s,i,e))}wt(t,s){let i=null,e=-1;for(const n of this.points){const o=h.Mt(n.x,n.y,t,s);o>n.bt||(e<0||o<e)&&(e=o,i=n)}return i}J(t){for(const t of this.points)t._t&&t.yt&&(t.it=t.Pt,t.nt=t.kt,t.Et&&(t.St=!1));this.B=!1,this.G=0,this.N=0,this.L=!1,this.U=null,this.q=null,this.H=null,this.O=null,this.l=!1}g(t){if(this.U=t.k,this.q=t.S,this.H=this.wt(t.k,t.S),null!==this.H&&(this.H.L=!0),this.B=null===this.H||!1===this.H.xt||!1===this.H._t,this.B)if(this.G=0,this.N=0,!1===t.ctrlKey)for(const t of this.points)t.At=!1;else for(const t of this.points)t.Dt=!1;else{if(t.ctrlKey)this.H.xt&&(this.H.At=!0);else if(!1===this.H.At){for(const t of this.points)t.At=!1;this.H.xt&&(this.H.At=!0)}for(const t of this.points)t._t&&t.yt&&(t.Pt=t.x,t.kt=t.y)}}W(t){if(null!==this.O){h.Mt(t.k,t.S,this.O.x,this.O.y)>this.O.bt&&(this.O.St=!1,this.O=null)}if(null===this.O){const s=this.wt(t.k,t.S);null!==s&&s.Et&&(this.O=s,this.O.St=!0)}}X(t){}Y(t){if(this.B){this.G=t.R,this.N=t.C;for(const s of this.points){if(!1===s.xt)continue;const i=h.Rt(s,t);i!=s.Dt&&(t.ctrlKey?s.At=!s.At:s.At=i,s.Dt=i)}}else for(const s of this.points)s._t&&s.yt&&this.st(s,s.Pt+t.R,s.kt+t.C,"event")}K(t){}j(t){if(null!==this.H&&this.H.xt&&!1===t.ctrlKey){for(const t of this.points)t.At=!1;this.H.At=!0}}v(t){this.B=!1,null!==this.H&&(this.H.L=!1)}et(t){const s=this.I.clientWidth/2;return Math.max(-s,Math.min(t,s))}ht(t){const s=this.I.clientHeight/2;return Math.max(-s,Math.min(t,s))}static Rt(t,s){const i=s.A,e=s.D,n=s.A+s.R,h=s.D+s.C;return t.x>=Math.min(i,n)&&t.y>=Math.min(e,h)&&t.x<=Math.max(i,n)&&t.y<=Math.max(e,h)}}class o{constructor(t,s,i){this.it=t,this.nt=s,this.Ct=function(t){return t.Tt??=5,t.It??=9,t.tags??=[],t.xt??=!0,t._t??=!0,t.Et??=!0,t}(i),this.At=!1,this.Dt=!1,this.St=!1,this.L=!1}get id(){return this.Ct.id}get x(){return this.it}get y(){return this.nt}get tags(){return this.Ct.tags}get bt(){return this.Bt?this.Ct.It:this.Ct.Tt}get Tt(){return this.Ct.Tt}get It(){return this.Ct.It}get _t(){return this.Ct._t}get xt(){return this.Ct.xt}get Et(){return this.Ct.Et}get yt(){return this.At}get Gt(){return this.Dt}get Bt(){return this.St}get Nt(){return this.L}}class r extends EventTarget{constructor(t,s){super(),this.$t=t(),this.Ft=this.$t,this.Lt=t,this.Ut=s}get(){return this.Lt()}set(t){this.Ut(t);const s=this.Ft!==t;this.Ft=t,s&&this.dispatchEvent(new CustomEvent("value-changed"))}reset(){this.set(this.$t)}}class a{constructor(t){this.qt=t,this.Ht=[]}Ot(){for(const t of this.Ht)t();this.Ht=[]}title(t){if("string"==typeof t){const s=document.createElement("span");s.innerText=t,t=s}t.classList.add("title"),this.qt.appendChild(t)}separator(){const t=document.createElement("div");t.classList.add("separator"),this.qt.appendChild(t)}add(t,s,i,e){if("string"==typeof s){const t=document.createElement("span");t.innerText=s,s=t}if(s.classList.add("key",t),i.classList.add("value",t),this.qt.appendChild(s),this.qt.appendChild(i),e){const t=document.createElement("button");if(t.innerText="R",t.title="Reset to initial value","function"==typeof e)t.addEventListener("click",e),this.Ht.push((()=>t.removeEventListener("click",e)));else{const s=()=>e.reset();t.addEventListener("click",s),this.Ht.push((()=>t.removeEventListener("click",s)))}this.qt.appendChild(t)}else this.qt.appendChild(document.createElement("span"))}}class c{static Vt(t){return 180*t/Math.PI}static Wt(t){return t<0?t:t-2*Math.PI}static Xt(t,s,i,e){const n=t-i,h=s-e;return Math.sqrt(n*n+h*h)}static Yt(t){return c.Xt(0,0,t.x,t.y)}static zt(t,s){return t>s?t-s:2*Math.PI-(s-t)}static Kt(t){return Math.atan2(t.y,t.x)}}class u extends EventTarget{constructor(t){super(),this.jt=t,this.Jt=null,this.Qt=null,this.Zt=null,this.ts=null,this.ss=0,this.es=0,this.ns(),this.hs(),this.os(),this.rs(),this.cs(),this.us(),this.ls()}get ds(){return this.ss}get ps(){return this.es}ns(){for(const t of this.jt.points)t.tags.includes(i)?this.Jt=t:t.tags.includes(e)?this.Qt=t:t.tags.includes(s)&&(this.Zt=t);if(null===this.Jt||null===this.Zt)throw new Error("Alpha start, alpha end and/or beta point(s) is/are missing.")}hs(){this.gs="enter",this.fs="enter"}vs(){this.Ms=c.Kt(this.Jt),this.ws=c.Yt(this.Jt),this.bs=c.Kt(this.Qt),this._s=c.Yt(this.Qt),this.ys=c.Kt(this.Zt),this.Ps=c.Yt(this.Zt)}os(){this.vs()}rs(){const t=c.Kt(this.Jt),s=Math.cos(t)*this.Ps,i=Math.sin(t)*this.Ps;this.jt.tt(this.Zt,s,i)}cs(){this.vs()}us(){const t=c.Kt(this.Zt);this.es=-Math.round(c.Vt(c.Wt(t)));const s=t,i=Math.cos(s)*this.ws,e=Math.sin(s)*this.ws,n=this.bs+(t-this.ys),h=Math.cos(n)*this._s,o=Math.sin(n)*this._s;this.jt.tt(this.Jt,i,e),this.jt.tt(this.Qt,h,o)}static ks(t,s,i){return s>i?t<=s&&t>=i:!1==(t<=i&&t>=s)}ls(){const s=c.Wt(c.Kt(this.Jt)),i=c.Wt(c.Kt(this.Qt)),e=c.zt(s,i);this.ss=Math.round(c.Vt(e));const n=(s-e)%(2*Math.PI);let h=0;for(const i of this.jt.points){if(!1===i.tags.includes(t))continue;const e=c.Wt(c.Kt(i));i.Es=u.ks(e,s,n),i.Es&&h++}this.ts!==h&&(this.dispatchEvent(new CustomEvent("infrustumcount-changed",{detail:h})),this.ts=h)}Ss(t){"event"===t.detail.rt&&(t.detail.ot.tags.includes(i)?"enter"===this.gs?(this.os(),this.gs="update"):"update"===this.gs&&this.rs():t.detail.ot.tags.includes(s)&&("enter"===this.fs?(this.cs(),this.fs="update"):"update"===this.fs&&this.us()),this.ls())}xs(){this.hs()}}class l{constructor(t,n){this.As=t,this.Ds=null,this.Rs="inner",this.Cs=.075,this.Jt=null,this.Qt=null,this.Zt=null;for(const t of n.points)t.tags.includes(i)?this.Jt=t:t.tags.includes(e)?this.Qt=t:t.tags.includes(s)&&(this.Zt=t);if(null===this.Jt||null===this.Qt||null===this.Zt)throw new Error("Alpha start, alpha end and/or beta point(s) is/are missing.")}get Cs(){return this.Ts}set Cs(t){t!==this.Ts&&(this.Ds=`rgba(0, 0, 0, ${t})`,this.Ts=t)}Is(){const t=this.As,s=c.Wt(c.Kt(this.Qt)),i=c.Wt(c.Kt(this.Zt)),e=Math.max(t.canvas.clientWidth,t.canvas.clientHeight),n=Math.cos(s)*e,h=Math.sin(s)*e,o=Math.cos(i)*e,r=Math.sin(i)*e,a=Math.max(t.canvas.width,t.canvas.height);if("none"!==this.Rs){const e="inner"===this.Rs;t.beginPath(),t.moveTo(0,0),t.lineTo(Math.cos(i)*a,Math.sin(i)*a),t.arc(0,0,a,i,s,e),t.lineTo(0,0),t.fillStyle=this.Ds,t.fill()}t.beginPath(),t.arc(0,0,30,i,s,!0),t.lineWidth=15,t.strokeStyle="rgba(255, 64, 64, 0.5)",t.stroke();const u=i-c.zt(i,s)/2;t.font="bold 24px Arial",t.fillStyle="rgba(255, 64, 64, 0.5)";const l=`α: ${Math.round(c.Vt(c.zt(i,s)))}°`,d=60*Math.cos(u),p=60*Math.sin(u);t.fillText(l,d,p),t.lineWidth=1,t.strokeStyle="red",t.strokeText(l,d,p),t.beginPath(),t.arc(0,0,50,0,i,!0),t.lineWidth=15,t.strokeStyle="rgba(0, 255, 64, 0.5)",t.stroke(),t.font="bold 24px Arial",t.fillStyle="rgba(0, 255, 64, 0.5)";const g=`β: ${Math.round(c.Vt(-i))}°`,f=60*Math.cos(i-i/2),m=60*Math.sin(i-i/2);t.fillText(g,f,m),t.lineWidth=1,t.strokeStyle="green",t.strokeText(g,f,m),t.beginPath(),t.moveTo(0,0),t.lineTo(n,h),t.lineWidth=1,t.strokeStyle="#a0a0a0",t.stroke(),t.beginPath(),t.moveTo(0,0),t.lineTo(o,r),t.lineWidth=1,t.strokeStyle="#a0a0a0",t.stroke()}}class d{constructor(t){this.As=t}Is(t){this.Bs(t)}Gs(n){return n.tags.includes(t)?n.Es?"royalblue":"lightblue":n.tags.includes(s)?"lime":n.tags.includes(i)||n.tags.includes(e)?"pink":"black"}Ns(t){return"black"}$s(t){return t.yt?t.Bt?4:3:1}Bs(t){const s=this.As;s.beginPath(),s.arc(t.x,t.y,t.bt,0,2*Math.PI),s.fillStyle=this.Gs(t),s.fill(),s.strokeStyle=this.Ns(t),s.lineWidth=this.$s(t),s.stroke()}}class p{constructor(t,s,i){this.As=t,this.jt=s,this.Fs=i,this.Ls=new d(t)}Is(){let t=null;for(const s of this.jt.points)!1!==this.Fs?.(s)&&(s.Bt?t=s:this.Ls.Is(s));null!==t&&this.Ls.Is(t)}}class g{constructor(t){this.As=t}Is(){const t=this.As,s=t.canvas.clientWidth/2,i=t.canvas.clientHeight/2;t.strokeStyle="#e0e0e0",t.beginPath(),t.moveTo(0,-i),t.lineTo(0,i),t.stroke(),t.beginPath(),t.moveTo(-s,0),t.lineTo(s,0),t.stroke()}}class f{constructor(t,s){this.As=t,this.jt=s}Is(){if(!1===this.jt.lt)return;const t=this.As;t.beginPath(),t.rect(this.jt.ct,this.jt.ut,this.jt.dt,this.jt.gt),t.fillStyle="rgba(0, 178, 255, 0.25)",t.fill(),t.strokeStyle="#c0c0c0",t.lineWidth=1,t.stroke()}}class m{constructor(s,i){const e=s.getContext("2d");this.As=e,this.Us=new l(e,i),this.qs=[new g(e),new p(e,i,(s=>s.tags.includes(t))),this.Us,new p(e,i,(s=>!1===s.tags.includes(t))),new f(e,i)],this.Hs(),s.width=s.clientWidth,s.height=s.clientHeight}Os(){this.Hs();const t=this.As,s=t.canvas;s.width=s.clientWidth,s.height=s.clientHeight;const i=s.clientWidth/2,e=s.clientHeight/2;t.translate(i,e),t.clearRect(-i,-e,i,e);for(const t of this.qs)t.Is()}Hs(){window.requestAnimationFrame((()=>this.Os()))}}class v{constructor(t){this.I=t}get name(){return"Dispatch"}get description(){return"Generates trees with a completely random distribution."}Vs(s){const i=this.I.width/2,e=this.I.height/2,n=[];for(let h=0;h<s;h++)n.push(new o((2*Math.random()-1)*i,(2*Math.random()-1)*e,{id:1e3+h+1,Tt:7,It:11,tags:[t]}));return n}}const M=2*Math.PI;class w{get name(){return"Circle"}get description(){return"Generates trees in circle, with a random radius."}Vs(s){const i=[];for(let e=0;e<s;e++){const n=M*e/s;i.push(new o(150*Math.cos(n),150*Math.sin(n),{id:1e3+e+1,Tt:7,It:11,tags:[t]}))}return i}}class b{static Ws(t,s){const i=document.createElement("span");return i.innerText=t,"string"==typeof s&&s.length>0&&(i.title=s),i}static Xs=function(t){const s=document.createElement("div"),i=document.createElement("div");i.classList.add("head");const e=document.createElement("span");e.classList.add("content"),e.innerText=t;const n=document.createElement("div");return n.classList.add("tail"),s.appendChild(i),s.appendChild(e),s.appendChild(n),s};static Ws(t,s){const i=document.createElement("span");return i.innerText=t,"string"==typeof s&&s.length>0&&(i.title=s),i}static Ys(t){let s=t??"";const i=b.Ws(s),e=new r((()=>s),(t=>s=t)),n=()=>i.innerText=e.get();return e.addEventListener("value-changed",n),{element:i,zs:e,Ot:()=>e.removeEventListener("value-changed",n)}}static Ks(t,s,i,e){const n=document.createElement("div");n.classList.add("slider-container");const h=document.createElement("input");h.type="range",h.min=s,h.max=i,h.step=e,h.value=t;const o=document.createElement("span");o.innerText=t;const a=new r((()=>Number(h.value)),(t=>{h.value=Number(t),o.innerText=t})),c=()=>a.set(h.value);return h.addEventListener("input",c),n.appendChild(h),n.appendChild(o),{element:n,zs:a,Ot:()=>h.removeEventListener("input",c)}}static js(t){const s=document.createElement("input");s.type="checkbox",s.checked=t;const i=new r((()=>Boolean(s.checked)),(t=>s.checked=Boolean(t))),e=()=>i.set(s.checked);return s.addEventListener("input",e),{element:s,zs:i,Ot:()=>s.removeEventListener("input",e)}}static Js(t){const s=document.createElement("select");for(const i of t){if(null==i)continue;const t=document.createElement("option");if("string"==typeof i)t.text=i;else{if("string"!=typeof i.text)continue;t.text=i.text,"string"==typeof i.title&&(t.title=i.title)}s.appendChild(t)}const i=new r((()=>s.selectedIndex),(t=>s.selectedIndex=t)),e=()=>i.set(s.selectedIndex);return s.addEventListener("input",e),{element:s,zs:i,Ot:()=>s.removeEventListener("input",e)}}static Qs(t,s){for(let i=0;i<t.options.length;i++)if(t.options[i].value===s)return i;return-1}static Zs(t){const s=document.createElement("select");for(const i of t){if(null==i)continue;const t=document.createElement("option");t.text=i.text,t.value=i.value,"string"==typeof i.title&&(t.title=i.title),s.appendChild(t)}const i=new r((()=>s.options[s.selectedIndex].value),(t=>s.selectedIndex=b.Qs(s,t))),e=()=>i.set(s.options[s.selectedIndex].value);return s.addEventListener("input",e),{element:s,zs:i,Ot:()=>s.removeEventListener("input",e)}}static ti(t,s){const i=document.createElement("button");return i.innerText=t,i.addEventListener("click",s),{element:i,Ot:()=>i.removeEventListener("click",s)}}}const _=[],y=function(t){return{text:t.name,title:t.description}},P=function(t,n,h,o,r){!function(t,n,h){t.title(b.Xs("Indicators"));const o=b.Ys("0"),r=b.Ys("0"),a=b.ti("Clear max",(()=>r.zs.set(0))),c=b.Ys("0°"),u=b.Ys("0°");n.addEventListener("pointmove",(t=>{t.detail.ot.tags.includes(i)||t.detail.ot.tags.includes(e)?c.zs.set(`${h.ds}°`):t.detail.ot.tags.includes(s)&&u.zs.set(`${h.ps}°`)})),t.add("alpha-angle","Alpha:",c.element),t.add("beta-angle","Beta:",u.element),t.add(null,"Trees in frustum:",o.element),t.add(null,"Max trees in frustum:",r.element),t.add(null,"",a.element),h.addEventListener("infrustumcount-changed",(t=>{r.zs.set(Math.max(r.zs.get(),t.detail)),o.zs.set(t.detail)}))}(t,n,h),function(t,s,i,e){let n;t.title(b.Xs("Generator"));const h=b.Ks(30,1,90),o=b.js(!1),r=b.Js(_.map(y)),a=b.ti("Generate",(()=>n()));n=()=>{const t=h.zs.get(),n=r.zs.get(),o=_[n].Vs(t);o.push(...e),s.Z(o),i.ls()},h.zs.addEventListener("value-changed",(()=>{o.zs.get()&&n()})),r.zs.addEventListener("value-changed",(()=>{o.zs.get()&&n()})),o.zs.addEventListener("value-changed",(()=>{a.element.disabled=o.zs.get(),o.zs.get()&&n()})),t.add(null,"Tree count:",h.element,h.zs),t.add(null,"Type:",r.element),t.add(null,b.Ws("Continuous gen.:","Continuous generation. Generates trees each time parameters change."),o.element),t.add(null,"",a.element),n()}(t,n,h,r),function(t,s){t.title(b.Xs("Emphasis"));const i=b.Zs([{text:"None",value:"none"},{text:"Inner view",value:"inner"},{text:"Outer view",value:"outer"}]);i.zs.set("inner"),t.add(null,"Emphasis:",i.element);const e=b.Ks(s.Cs,.05,.5,.001);t.add(null,"Transparency:",e.element,e.zs),i.zs.addEventListener("value-changed",(()=>{s.Rs=i.zs.get(),e.element.childNodes[0].disabled="none"===s.Rs})),e.zs.addEventListener("value-changed",(()=>{s.Cs=e.zs.get()}))}(t,o)};window.addEventListener("load",(function(){document.querySelector(".root-container > .side-bar > .git-info").innerText="7c821273bf732211a538299094c92b7e3896b837".substring(0,9);const t=document.querySelector(".root-container > canvas.render"),n=document.querySelector(".root-container > .side-bar > .property-grid-scroller > .property-grid");_.push(new v(t)),_.push(new w);const r=new a(n),c=[new o(40,-120,{id:1,Tt:9,It:12,tags:[i]}),new o(-40,-120,{id:2,Tt:9,It:12,tags:[e]}),new o(120,120,{id:3,Tt:9,It:12,tags:[s]})],l=new h(t,c),d=new u(l,c);l.addEventListener("pointmove",(t=>d.Ss(t))),t.addEventListener("pointerup",(t=>d.xs()));const p=new m(t,l);P(r,l,d,p.Us,c)}));
