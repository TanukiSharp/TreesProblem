const t="tree",s="beta",i="alpha-start",e="alpha-end";class n extends EventTarget{constructor(t,s,i){super(),this.t=t,this.i=s,this.h=i,this.o=null,this.u=null,this.l=!1,this.p=!1,t.addEventListener("pointerdown",(t=>this.g(t))),t.addEventListener("pointermove",(t=>this.m(t))),t.addEventListener("pointerup",(t=>this.v(t))),document.addEventListener("keydown",(t=>this.M(t)))}_(t,s){this.dispatchEvent(new CustomEvent(t,{detail:s}))}M(t){"Escape"===t.key&&this.k&&!1===this.p&&(this.p=!0,this._("cancelled",t))}g(t){this.p=!1,t.target.setPointerCapture(t.pointerId),t.P=this.i(t.offsetX),t.S=this.h(t.offsetY),this._("pointerdown-begin",t),this.k=!0,this.o=t.P,this.u=t.S,this._("pointerdown-end",t)}m(t){if(!this.p){if(t.P=this.i(t.offsetX),t.S=this.h(t.offsetY),t.A=this.o,t.D=this.u,this._("pointermove-begin",t),this.k){const s=t.P-this.o,i=t.S-this.u;t.R=s,t.C=i,!1===this.l?(Math.abs(s)>6||Math.abs(i)>6)&&(this.l=!0,t.A=this.o,t.D=this.u,this._("drag-start",t)):(t.A=this.o,t.D=this.u,this._("drag-move",t))}else this._("nodrag-pointermove",t);this._("pointermove-end",t)}}v(t){if(t.target.releasePointerCapture(t.pointerId),this.p)return this.T(),void(this.p=!1);t.P=this.i(t.offsetX),t.S=this.h(t.offsetY),t.A=this.o,t.D=this.u,this._("pointerup-begin",t),this.l?this._("drag-finish",t):this._("click",t),this.T(),this._("pointerup-end",t)}T(){this.l=!1,this.k=!1,this.o=null,this.u=null}}class h extends EventTarget{constructor(t,s){super(),this.I=t,this.points=s??[],this.B=!1,this.G=0,this.$=0,this.F=6,this.L=6,this.N=!1,this.U=null,this.H=null,this.O=null,this.q=null,this.l=!1,this.V=new n(t,(s=>s-t.clientWidth/2),(s=>s-t.clientHeight/2)),this.V.addEventListener("pointerdown-begin",(t=>this.g(t.detail))),this.V.addEventListener("nodrag-pointermove",(t=>this.W(t.detail))),this.V.addEventListener("drag-start",(t=>this.X(t.detail))),this.V.addEventListener("drag-move",(t=>this.Y(t.detail))),this.V.addEventListener("drag-finish",(t=>this.K(t.detail))),this.V.addEventListener("click",(t=>this.j(t.detail))),this.V.addEventListener("pointerup-begin",(t=>this.v(t.detail))),this.V.addEventListener("cancelled",(t=>this.J(t.detail)))}Z(t,s,i,e){t.tt=this.st(s),t.it=this.et(i),this.dispatchEvent(new CustomEvent("pointmove",{detail:{nt:t,ht:e}}))}ot(t,s,i){this.Z(t,s,i,"user")}get rt(){return this.U}get ct(){return this.H}get ut(){return this.B}get lt(){return this.G}get dt(){return this.$}static gt(t){return t.P=t.offsetX-t.target.clientWidth/2,t.S=t.offsetY-t.target.clientHeight/2,t}static ft(t,s,i,e){const n=i-t,h=e-s;return n*n+h*h}static vt(t,s,i,e){return Math.sqrt(h.ft(t,s,i,e))}Mt(t,s){let i=null,e=-1;for(const n of this.points){const o=h.vt(n.x,n.y,t,s);o>n.wt||(e<0||o<e)&&(e=o,i=n)}return i}J(t){for(const t of this.points)t.bt&&t._t&&(t.tt=t.yt,t.it=t.kt,t.Pt&&(t.Et=!1));this.B=!1,this.G=0,this.$=0,this.N=!1,this.U=null,this.H=null,this.O=null,this.q=null,this.l=!1}g(t){if(this.U=t.P,this.H=t.S,this.O=this.Mt(t.P,t.S),null!==this.O&&(this.O.N=!0),this.B=null===this.O||!1===this.O.St||!1===this.O.bt,this.B)if(this.G=0,this.$=0,!1===t.ctrlKey)for(const t of this.points)t.xt=!1;else for(const t of this.points)t.At=!1;else{if(t.ctrlKey)this.O.St&&(this.O.xt=!0);else if(!1===this.O.xt){for(const t of this.points)t.xt=!1;this.O.St&&(this.O.xt=!0)}for(const t of this.points)t.bt&&t._t&&(t.yt=t.x,t.kt=t.y)}}W(t){if(null!==this.q){h.vt(t.P,t.S,this.q.x,this.q.y)>this.q.wt&&(this.q.Et=!1,this.q=null)}if(null===this.q){const s=this.Mt(t.P,t.S);null!==s&&s.Pt&&(this.q=s,this.q.Et=!0)}}X(t){}Y(t){if(this.B){this.G=t.R,this.$=t.C;for(const s of this.points){if(!1===s.St)continue;const i=h.Dt(s,t);i!=s.At&&(t.ctrlKey?s.xt=!s.xt:s.xt=i,s.At=i)}}else for(const s of this.points)s.bt&&s._t&&this.Z(s,s.yt+t.R,s.kt+t.C,"event")}K(t){}j(t){if(null!==this.O&&this.O.St&&!1===t.ctrlKey){for(const t of this.points)t.xt=!1;this.O.xt=!0}}v(t){this.B=!1,null!==this.O&&(this.O.N=!1)}st(t){const s=this.I.clientWidth/2;return Math.max(-s,Math.min(t,s))}et(t){const s=this.I.clientHeight/2;return Math.max(-s,Math.min(t,s))}static Dt(t,s){const i=s.A,e=s.D,n=s.A+s.R,h=s.D+s.C;return t.x>=Math.min(i,n)&&t.y>=Math.min(e,h)&&t.x<=Math.max(i,n)&&t.y<=Math.max(e,h)}}class o{constructor(t,s,i){this.tt=t,this.it=s,this.Rt=function(t){return t.Ct??=5,t.Tt??=9,t.tags??=[],t.St??=!0,t.bt??=!0,t.Pt??=!0,t}(i),this.xt=!1,this.At=!1,this.Et=!1,this.N=!1}get id(){return this.Rt.id}get x(){return this.tt}get y(){return this.it}get tags(){return this.Rt.tags}get wt(){return this.It?this.Rt.Tt:this.Rt.Ct}get Ct(){return this.Rt.Ct}get Tt(){return this.Rt.Tt}get bt(){return this.Rt.bt}get St(){return this.Rt.St}get Pt(){return this.Rt.Pt}get _t(){return this.xt}get Bt(){return this.At}get It(){return this.Et}get Gt(){return this.N}}class r extends EventTarget{constructor(t,s){super(),this.$t=t(),this.Ft=this.$t,this.Lt=t,this.Nt=s}get(){return this.Lt()}set(t){this.Nt(t);const s=this.Ft!==t;this.Ft=t,s&&this.dispatchEvent(new CustomEvent("value-changed"))}reset(){this.set(this.$t)}}class a{constructor(t){this.Ut=t,this.Ht=[]}Ot(){for(const t of this.Ht)t();this.Ht=[]}title(t){if("string"==typeof t){const s=document.createElement("span");s.innerText=t,t=s}t.classList.add("title"),this.Ut.appendChild(t)}separator(){const t=document.createElement("div");t.classList.add("separator"),this.Ut.appendChild(t)}add(t,s,i,e){if("string"==typeof s){const t=document.createElement("span");t.innerText=s,s=t}if(s.classList.add("key",t),i.classList.add("value",t),this.Ut.appendChild(s),this.Ut.appendChild(i),e){const t=document.createElement("button");if(t.innerText="R",t.title="Reset to initial value","function"==typeof e)t.addEventListener("click",e),this.Ht.push((()=>t.removeEventListener("click",e)));else{const s=()=>e.reset();t.addEventListener("click",s),this.Ht.push((()=>t.removeEventListener("click",s)))}this.Ut.appendChild(t)}else this.Ut.appendChild(document.createElement("span"))}}class c{static qt(t){return 180*t/Math.PI}static Vt(t){return t<0?t:t-2*Math.PI}static Wt(t,s,i,e){const n=t-i,h=s-e;return Math.sqrt(n*n+h*h)}static Xt(t){return c.Wt(0,0,t.x,t.y)}static Yt(t,s){return t>s?t-s:2*Math.PI-(s-t)}static zt(t){return Math.atan2(t.y,t.x)}}class u extends EventTarget{constructor(t,n){super(),this.Kt=t,this.jt=null,this.Jt=null,this.Qt=null,this.Zt=null,this.ts=0,this.ss=0;for(const t of n)t.tags.includes(i)?this.jt=t:t.tags.includes(e)?this.Jt=t:t.tags.includes(s)&&(this.Qt=t);if(null===this.jt||null===this.Qt)throw new Error("Alpha start, alpha end and/or beta point(s) is/are missing.");this.es(),this.ns(),this.hs(),this.os()}get rs(){return this.ts}get cs(){return this.ss}es(){this.us="enter",this.ls="enter"}ds(){this.ps=c.zt(this.jt),this.gs=c.Xt(this.jt),this.fs=c.zt(this.Jt),this.vs=c.Xt(this.Jt),this.Ms=c.zt(this.Qt),this.ws=c.Xt(this.Qt)}ns(){this.ds()}hs(){const t=c.zt(this.jt),s=Math.cos(t)*this.ws,i=Math.sin(t)*this.ws;this.Kt.ot(this.Qt,s,i)}bs(){this.ds()}_s(){const t=c.zt(this.Qt);this.ss=-Math.round(c.qt(c.Vt(t)));const s=t,i=Math.cos(s)*this.gs,e=Math.sin(s)*this.gs,n=this.fs+(t-this.Ms),h=Math.cos(n)*this.vs,o=Math.sin(n)*this.vs;this.Kt.ot(this.jt,i,e),this.Kt.ot(this.Jt,h,o)}static ys(t,s,i){return s>i?t<=s&&t>=i:!1==(t<=i&&t>=s)}os(){const s=c.Vt(c.zt(this.jt)),i=c.Vt(c.zt(this.Jt)),e=c.Yt(s,i);this.ts=Math.round(c.qt(e));const n=(s-e)%(2*Math.PI);let h=0;for(const i of this.Kt.points){if(!1===i.tags.includes(t))continue;const e=c.Vt(c.zt(i));i.ks=u.ys(e,s,n),i.ks&&h++}this.Zt!==h&&(this.dispatchEvent(new CustomEvent("infrustumcount-changed",{detail:h})),this.Zt=h)}Ps(t){"event"===t.detail.ht&&(t.detail.nt.tags.includes(i)?"enter"===this.us?(this.ns(),this.us="update"):"update"===this.us&&this.hs():t.detail.nt.tags.includes(s)&&("enter"===this.ls?(this.bs(),this.ls="update"):"update"===this.ls&&this._s()),this.os())}Es(){this.es()}}class l{constructor(t,n){this.Ss=t,this.xs=null,this.As="inner",this.Ds=.075,this.jt=null,this.Jt=null,this.Qt=null;for(const t of n)t.tags.includes(i)?this.jt=t:t.tags.includes(e)?this.Jt=t:t.tags.includes(s)&&(this.Qt=t);if(null===this.jt||null===this.Jt||null===this.Qt)throw new Error("Alpha start, alpha end and/or beta point(s) is/are missing.")}get Ds(){return this.Rs}set Ds(t){t!==this.Rs&&(this.xs=`rgba(0, 0, 0, ${t})`,this.Rs=t)}Cs(){const t=this.Ss,s=c.Vt(c.zt(this.Jt)),i=c.Vt(c.zt(this.Qt)),e=Math.max(t.canvas.clientWidth,t.canvas.clientHeight),n=Math.cos(s)*e,h=Math.sin(s)*e,o=Math.cos(i)*e,r=Math.sin(i)*e,a=Math.max(t.canvas.width,t.canvas.height);if("none"!==this.As){const e="inner"===this.As;t.beginPath(),t.moveTo(0,0),t.lineTo(Math.cos(i)*a,Math.sin(i)*a),t.arc(0,0,a,i,s,e),t.lineTo(0,0),t.fillStyle=this.xs,t.fill()}t.beginPath(),t.arc(0,0,30,i,s,!0),t.lineWidth=15,t.strokeStyle="rgba(255, 64, 64, 0.5)",t.stroke();const u=i-c.Yt(i,s)/2;t.font="bold 24px Arial",t.fillStyle="rgba(255, 64, 64, 0.5)";const l=`α: ${Math.round(c.qt(c.Yt(i,s)))}°`,d=60*Math.cos(u),p=60*Math.sin(u);t.fillText(l,d,p),t.lineWidth=1,t.strokeStyle="red",t.strokeText(l,d,p),t.beginPath(),t.arc(0,0,50,0,i,!0),t.lineWidth=15,t.strokeStyle="rgba(0, 255, 64, 0.5)",t.stroke(),t.font="bold 24px Arial",t.fillStyle="rgba(0, 255, 64, 0.5)";const g=`β: ${Math.round(c.qt(-i))}°`,f=60*Math.cos(i-i/2),m=60*Math.sin(i-i/2);t.fillText(g,f,m),t.lineWidth=1,t.strokeStyle="green",t.strokeText(g,f,m),t.beginPath(),t.moveTo(0,0),t.lineTo(n,h),t.lineWidth=1,t.strokeStyle="#a0a0a0",t.stroke(),t.beginPath(),t.moveTo(0,0),t.lineTo(o,r),t.lineWidth=1,t.strokeStyle="#a0a0a0",t.stroke()}}class d{constructor(t){this.Ss=t}Cs(t){this.Ts(t)}Is(n){return n.tags.includes(t)?n.ks?"royalblue":"lightblue":n.tags.includes(s)?"lime":n.tags.includes(i)||n.tags.includes(e)?"pink":"black"}Bs(t){return"black"}Gs(t){return t._t?t.It?4:3:1}Ts(t){const s=this.Ss;s.beginPath(),s.arc(t.x,t.y,t.wt,0,2*Math.PI),s.fillStyle=this.Is(t),s.fill(),s.strokeStyle=this.Bs(t),s.lineWidth=this.Gs(t),s.stroke()}}class p{constructor(t,s){this.Ss=t,this.Kt=s,this.$s=new d(t)}Cs(){let t=null;for(const s of this.Kt.points)s.It?t=s:this.$s.Cs(s);null!==t&&this.$s.Cs(t)}}class g{constructor(t){this.Ss=t}Cs(){const t=this.Ss,s=t.canvas.clientWidth/2,i=t.canvas.clientHeight/2;t.strokeStyle="#e0e0e0",t.beginPath(),t.moveTo(0,-i),t.lineTo(0,i),t.stroke(),t.beginPath(),t.moveTo(-s,0),t.lineTo(s,0),t.stroke()}}class f{constructor(t,s){this.Ss=t,this.Kt=s}Cs(){if(!1===this.Kt.ut)return;const t=this.Ss;t.beginPath(),t.rect(this.Kt.rt,this.Kt.ct,this.Kt.lt,this.Kt.dt),t.fillStyle="rgba(0, 178, 255, 0.25)",t.fill(),t.strokeStyle="#c0c0c0",t.lineWidth=1,t.stroke()}}class m{constructor(t,s,i){const e=t.getContext("2d");this.Ss=e,this.Fs=new l(e,i),this.Ls=[new g(e),new p(e,s),this.Fs,new f(e,s)],this.Ns()}Us(){this.Ns();const t=this.Ss,s=t.canvas;s.width=s.clientWidth,s.height=s.clientHeight;const i=s.clientWidth/2,e=s.clientHeight/2;t.translate(i,e),t.clearRect(-i,-e,i,e);for(const t of this.Ls)t.Cs()}Ns(){window.requestAnimationFrame((()=>this.Us()))}}class v{constructor(t){this.I=t}get name(){return"Dispatch"}get description(){return"Generates trees with a completely random distribution."}Hs(s){const i=this.I.width/2,e=this.I.height/2,n=[];for(let h=0;h<s;h++)n.push(new o((2*Math.random()-1)*i,(2*Math.random()-1)*e,{id:1e3+h+1,Ct:7,Tt:11,tags:[t]}));return n}}const M=2*Math.PI;class w{get name(){return"Circle"}get description(){return"Generates trees in circle, with a random radius."}Hs(s){const i=[];for(let e=0;e<s;e++){const n=M*e/s;i.push(new o(150*Math.cos(n),150*Math.sin(n),{id:1e3+e+1,Ct:7,Tt:11,tags:[t]}))}return i}}class b{static Os(t,s){const i=document.createElement("span");return i.innerText=t,"string"==typeof s&&s.length>0&&(i.title=s),i}static qs=function(t){const s=document.createElement("div"),i=document.createElement("div");i.classList.add("head");const e=document.createElement("span");e.classList.add("content"),e.innerText=t;const n=document.createElement("div");return n.classList.add("tail"),s.appendChild(i),s.appendChild(e),s.appendChild(n),s};static Os(t,s){const i=document.createElement("span");return i.innerText=t,"string"==typeof s&&s.length>0&&(i.title=s),i}static Vs(t){let s=t??"";const i=b.Os(s),e=new r((()=>s),(t=>s=t)),n=()=>i.innerText=e.get();return e.addEventListener("value-changed",n),{element:i,Ws:e,Ot:()=>e.removeEventListener("value-changed",n)}}static Xs(t,s,i,e){const n=document.createElement("div");n.classList.add("slider-container");const h=document.createElement("input");h.type="range",h.min=s,h.max=i,h.step=e,h.value=t;const o=document.createElement("span");o.innerText=t;const a=new r((()=>Number(h.value)),(t=>{h.value=Number(t),o.innerText=t})),c=()=>a.set(h.value);return h.addEventListener("input",c),n.appendChild(h),n.appendChild(o),{element:n,Ws:a,Ot:()=>h.removeEventListener("input",c)}}static Ys(t){const s=document.createElement("input");s.type="checkbox",s.checked=t;const i=new r((()=>Boolean(s.checked)),(t=>s.checked=Boolean(t))),e=()=>i.set(s.checked);return s.addEventListener("input",e),{element:s,Ws:i,Ot:()=>s.removeEventListener("input",e)}}static zs(t){const s=document.createElement("select");for(const i of t){if(null==i)continue;const t=document.createElement("option");if("string"==typeof i)t.text=i;else{if("string"!=typeof i.text)continue;t.text=i.text,"string"==typeof i.title&&(t.title=i.title)}s.appendChild(t)}const i=new r((()=>s.selectedIndex),(t=>s.selectedIndex=t)),e=()=>i.set(s.selectedIndex);return s.addEventListener("input",e),{element:s,Ws:i,Ot:()=>s.removeEventListener("input",e)}}static Ks(t,s){for(let i=0;i<t.options.length;i++)if(t.options[i].value===s)return i;return-1}static js(t){const s=document.createElement("select");for(const i of t){if(null==i)continue;const t=document.createElement("option");t.text=i.text,t.value=i.value,"string"==typeof i.title&&(t.title=i.title),s.appendChild(t)}const i=new r((()=>s.options[s.selectedIndex].value),(t=>s.selectedIndex=b.Ks(s,t))),e=()=>i.set(s.options[s.selectedIndex].value);return s.addEventListener("input",e),{element:s,Ws:i,Ot:()=>s.removeEventListener("input",e)}}static Js(t,s){const i=document.createElement("button");return i.innerText=t,i.addEventListener("click",s),{element:i,Ot:()=>i.removeEventListener("click",s)}}}const _=[],y=function(t){return{text:t.name,title:t.description}},k=function(t,n,h,o,r){!function(t,n,h){t.title(b.qs("Indicators"));const o=b.Vs("0"),r=b.Vs("0"),a=b.Js("Clear max",(()=>r.Ws.set(0))),c=b.Vs("0°"),u=b.Vs("0°");n.addEventListener("pointmove",(t=>{t.detail.nt.tags.includes(i)||t.detail.nt.tags.includes(e)?c.Ws.set(`${h.rs}°`):t.detail.nt.tags.includes(s)&&u.Ws.set(`${h.cs}°`)})),t.add("alpha-angle","Alpha:",c.element),t.add("beta-angle","Beta:",u.element),t.add(null,"Trees in frustum:",o.element),t.add(null,"Max trees in frustum:",r.element),t.add(null,"",a.element),h.addEventListener("infrustumcount-changed",(t=>{r.Ws.set(Math.max(r.Ws.get(),t.detail)),o.Ws.set(t.detail)}))}(t,n,h),function(t,s,i,e){let n;t.title(b.qs("Generator"));const h=b.Xs(30,1,90),o=b.Ys(!1),r=b.zs(_.map(y)),a=b.Js("Generate",(()=>n()));n=()=>{const t=h.Ws.get(),n=r.Ws.get();s.points=_[n].Hs(t),s.points.push(...e),i.os()},h.Ws.addEventListener("value-changed",(()=>{o.Ws.get()&&n()})),r.Ws.addEventListener("value-changed",(()=>{o.Ws.get()&&n()})),o.Ws.addEventListener("value-changed",(()=>{a.element.disabled=o.Ws.get(),o.Ws.get()&&n()})),t.add(null,"Tree count:",h.element,h.Ws),t.add(null,"Type:",r.element),t.add(null,b.Os("Continuous gen.:","Continuous generation. Generates trees each time parameters change."),o.element),t.add(null,"",a.element)}(t,n,h,r),function(t,s){t.title(b.qs("Emphasis"));const i=b.js([{text:"None",value:"none"},{text:"Inner view",value:"inner"},{text:"Outer view",value:"outer"}]);i.Ws.set("inner"),t.add(null,"Emphasis:",i.element);const e=b.Xs(s.Ds,.05,.5,.001);t.add(null,"Transparency:",e.element,e.Ws),i.Ws.addEventListener("value-changed",(()=>{s.As=i.Ws.get(),e.element.childNodes[0].disabled="none"===s.As})),e.Ws.addEventListener("value-changed",(()=>{s.Ds=e.Ws.get()}))}(t,o)};window.addEventListener("load",(function(){document.querySelector(".root-container > .side-bar > .git-info").innerText="ca1aa7bfa04a2f09a2736a87cbe5667a72ff642f".substring(0,9);const t=document.querySelector(".root-container > canvas.render"),n=document.querySelector(".root-container > .side-bar > .property-grid-scroller > .property-grid");_.push(new v(t)),_.push(new w);const r=new a(n),c=[new o(40,-120,{id:1,Ct:9,Tt:12,tags:[i]}),new o(-40,-120,{id:2,Ct:9,Tt:12,tags:[e]}),new o(120,120,{id:3,Ct:9,Tt:12,tags:[s]})],l=new h(t),d=new u(l,c);l.addEventListener("pointmove",(t=>d.Ps(t))),t.addEventListener("pointerup",(t=>d.Es()));const p=new m(t,l,c);k(r,l,d,p.Fs,c)}));
